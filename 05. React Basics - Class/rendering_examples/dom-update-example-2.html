<!doctype html>
<html>
  <head>
    <style>
      .row {
        display: flex;
        gap: 10px;
        margin: 20px 0;
      }
      .box {
        width: 80px;
        height: 80px;
        border-radius: 12px;
        background: steelblue;
      }
      button {
        padding: 10px 14px;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <button id="btn">Toggle</button>

    <div class="row">
      <div id="a" class="box"></div>
      <div id="b" class="box"></div>
      <div id="c" class="box"></div>
    </div>

    <script>
      const boxes = [
        document.getElementById("a"),
        document.getElementById("b"),
        document.getElementById("c"),
      ];

      let on = false;
      let scheduled = false;
      let nextColor = "steelblue";

      function scheduleRender() {
        if (scheduled) return;
        scheduled = true;

        requestAnimationFrame(() => {
          debugger; // all DOM writes happen together in one frame
          for (const el of boxes) el.style.background = nextColor;
          scheduled = false;
        });
      }

      document.getElementById("btn").addEventListener("click", () => {
        on = !on;
        nextColor = on ? "tomato" : "steelblue";

        // you can call this multiple times; it still paints once
        scheduleRender();
        scheduleRender();
        scheduleRender();
      });
    </script>
  </body>
</html>
